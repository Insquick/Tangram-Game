<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tangram Challenge</title>
  <link href="https://fonts.googleapis.com/css2?family=ZCOOL+XiaoWei&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <style>
    body {
      font-family: 'ZCOOL XiaoWei', serif;
      background: #1e1e1e;
      color: #ffffff;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow: hidden;
      position: relative;
    }

    body::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        linear-gradient(45deg, transparent 75%, rgba(255, 255, 255, 0.1) 75%),
        linear-gradient(-45deg, transparent 75%, rgba(200, 200, 200, 0.1) 75%),
        linear-gradient(135deg, transparent 75%, rgba(150, 150, 150, 0.1) 75%),
        linear-gradient(-135deg, transparent 75%, rgba(100, 100, 100, 0.1) 75%);
      background-size: 40px 40px;
      z-index: -1;
    }

    .container {
      background: #2c2c2c;
      padding: 2rem;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      text-align: center;
      max-width: 800px;
      width: 90%;
      position: relative;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }

    #setup {
      margin-bottom: 2rem;
    }

    #setup label {
      display: block;
      margin: 0.5rem 0;
      font-size: 1.2rem;
    }

    #setup input, #setup select {
      font-family: 'ZCOOL XiaoWei', serif;
      font-size: 1rem;
      padding: 0.5rem;
      border-radius: 5px;
      border: none;
      margin-bottom: 1rem;
      width: 100%;
    }

    #start-button {
      padding: 0.8rem 1.5rem;
      font-size: 1rem;
      color: white;
      background: #3498db;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s ease;
      width: 100%;
    }

    #start-button:hover {
      background: #2980b9;
    }

    #game {
      display: none;
    }

    #timer {
      font-size: 2rem;
      font-weight: bold;
      margin: 1rem 0;
    }

    #times-up-message {
      display: none;
      font-size: 1.5rem;
      color: #e74c3c;
      margin-top: 1rem;
    }

    .puzzle-container {
      margin: 1.5rem 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }

    .silhouette {
      cursor: pointer;
      border-radius: 15px;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      position: relative;
      background: #3e3e3e;
      padding: 10px;
      max-width: 300px;
      width: 100%;
    }

    .silhouette:hover {
      transform: translateY(-10px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
    }

    .silhouette img {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 10px;
    }

    .score-input {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
      justify-content: center;
    }

    .score-input button {
      padding: 0.8rem 1.5rem;
      font-size: 1rem;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .score-input button.correct {
      background: #2ecc71;
    }

    .score-input button.correct:hover {
      background: #27ae60;
    }

    .score-input button.incorrect {
      background: #e74c3c;
    }

    .score-input button.incorrect:hover {
      background: #c0392b;
    }

    #team-display {
      margin-top: 1rem;
      font-size: 1.2rem;
    }

    #round-counter {
      font-size: 1.5rem;
      margin: 1rem 0;
    }

    #end-game-button {
      margin-top: 1rem;
      padding: 0.8rem 1.5rem;
      font-size: 1rem;
      color: white;
      background: #e74c3c;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s ease;
      width: 100%;
    }

    #end-game-button:hover {
      background: #c0392b;
    }

    #score-display {
      margin-top: 2rem;
      font-size: 1.2rem;
      display: none;
    }

    #winner-display {
      font-size: 2.5rem;
      color: #2ecc71;
      margin-bottom: 1rem;
      display: none;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    th, td {
      padding: 0.5rem;
      border: 1px solid #444;
    }

    th {
      background: #444;
    }

    #play-again-button {
      margin-top: 1rem;
      padding: 0.8rem 1.5rem;
      font-size: 1rem;
      color: white;
      background: #3498db;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s ease;
      width: 100%;
    }

    #play-again-button:hover {
      background: #2980b9;
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 2rem;
      }

      .container {
        padding: 1rem;
      }

      #timer {
        font-size: 1.5rem;
      }

      #round-counter {
        font-size: 1.2rem;
      }

      .silhouette {
        max-width: 200px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 id="game-title">Tangram Challenge</h1>
    <div id="setup">
      <label for="timer-minutes">Timer Duration (minutes):</label>
      <input type="number" id="timer-minutes" min="1" max="10" value="1">
      <label for="teams">Number of Teams (1â€“6):</label>
      <select id="teams">
        <option value="1">1 Team</option>
        <option value="2">2 Teams</option>
        <option value="3">3 Teams</option>
        <option value="4">4 Teams</option>
        <option value="5">5 Teams</option>
        <option value="6">6 Teams</option>
      </select>
      <button id="start-button" onclick="startGame()">Start Game</button>
    </div>
    <div id="game">
      <div id="round-counter">Round: <span id="current-round">1</span>/5</div>
      <div id="timer">1:00</div>
      <div id="times-up-message">Time's Up!</div>
      <div id="team-display">Team: <span id="current-team">Blue</span></div>
      <div class="puzzle-container">
        <div class="silhouette" data-color="puzzle.png">
          <img src="kouti.png" alt="Tangram Silhouette">
        </div>
      </div>
      <button id="end-game-button" onclick="endGame()">End Game</button>
      <div id="score-display">
        <div id="winner-display"></div>
        <table id="score-table">
          <thead>
            <tr>
              <th>Team</th>
              <th>Round 1</th>
              <th>Round 2</th>
              <th>Round 3</th>
              <th>Round 4</th>
              <th>Round 5</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <button id="play-again-button" onclick="startGame()">Play Again</button>
      </div>
    </div>
  </div>

  <script>
    const puzzles = [
      { silhouette: "kouti.png", color: "puzzle.png" },
      { silhouette: "Snapshot_2.png", color: "lol.png" },
    ];

    const teamColors = ["Red", "Blue", "Yellow", "Green", "Purple", "Orange"];
    const teamScores = Array.from({ length: 6 }, () => Array(5).fill(0));
    let currentPuzzleIndex = 0;
    let currentTeamIndex = 0;
    let currentRound = 1;
    let timeLeft = 60;
    let timerDuration = 1;
    let timerInterval;
    const timerElement = document.getElementById('timer');
    const timesUpMessage = document.getElementById('times-up-message');
    const currentTeamDisplay = document.getElementById('current-team');
    const currentRoundDisplay = document.getElementById('current-round');
    const setupSection = document.getElementById('setup');
    const gameSection = document.getElementById('game');
    const scoreDisplay = document.getElementById('score-display');
    const winnerDisplay = document.getElementById('winner-display');
    const scoreTableBody = document.querySelector('#score-table tbody');
    const gameTitle = document.getElementById('game-title');
    const silhouetteElement = document.querySelector('.silhouette');

    function startGame() {
      timerDuration = parseInt(document.getElementById('timer-minutes').value, 10);
      const numberOfTeams = parseInt(document.getElementById('teams').value, 10);

      teamScores.forEach(team => team.fill(0));
      currentRound = 1;
      currentRoundDisplay.textContent = currentRound;

      setupSection.style.display = "none";
      gameSection.style.display = "block";
      scoreDisplay.style.display = "none";
      winnerDisplay.style.display = "none";

      currentTeamIndex = 0;
      updateTeamDisplay();
      timeLeft = timerDuration * 60;
      startTimer();
    }

    function startTimer() {
      clearInterval(timerInterval);
      timerInterval = setInterval(updateTimer, 1000);
    }

    function updateTimer() {
      const minutes = Math.floor(timeLeft / 60);
      const seconds = timeLeft % 60;
      timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
      timeLeft--;

      if (timeLeft < 0) {
        clearInterval(timerInterval);
        timesUpMessage.style.display = "block";
      }
    }

    function updateTeamDisplay() {
      const currentColor = teamColors[currentTeamIndex].toLowerCase();
      currentTeamDisplay.textContent = teamColors[currentTeamIndex];
      currentTeamDisplay.style.color = currentColor;
      currentRoundDisplay.style.color = currentColor;
      gameTitle.style.color = currentColor;
    }

    silhouetteElement.addEventListener('click', () => {
      if (!document.querySelector('.score-input')) {
        const colorImage = puzzles[currentPuzzleIndex].color;
        silhouetteElement.innerHTML = `<img src="${colorImage}" alt="Tangram Color">`;
        clearInterval(timerInterval);
        showScoreInput();
      }
    });

    function showScoreInput() {
      const scoreInput = `
        <div class="score-input">
          <button class="correct" onclick="handleScoreInput(true)">Correct</button>
          <button class="incorrect" onclick="handleScoreInput(false)">Incorrect</button>
        </div>
      `;
      document.querySelector('.puzzle-container').insertAdjacentHTML('beforeend', scoreInput);
    }

    function handleScoreInput(isCorrect) {
      if (isCorrect) teamScores[currentTeamIndex][currentRound - 1]++;
      document.querySelector('.score-input').remove();
      nextRound();
    }

    function nextRound() {
      currentTeamIndex = (currentTeamIndex + 1) % parseInt(document.getElementById('teams').value, 10);
      updateTeamDisplay();

      if (currentTeamIndex === 0) {
        currentRound++;
        currentRoundDisplay.textContent = currentRound;
      }

      if (currentRound > 5) {
        endGame();
        return;
      }

      currentPuzzleIndex = (currentPuzzleIndex + 1) % puzzles.length;
      silhouetteElement.innerHTML = `<img src="${puzzles[currentPuzzleIndex].silhouette}" alt="Tangram Silhouette">`;
      timesUpMessage.style.display = "none";
      timeLeft = timerDuration * 60;
      startTimer();
    }

    function endGame() {
      clearInterval(timerInterval);
      gameSection.style.display = "none";
      scoreDisplay.style.display = "block";

      const totalScores = teamScores.map(team => team.reduce((a, b) => a + b, 0));
      const maxScore = Math.max(...totalScores);
      const winningTeams = teamColors.filter((_, index) => totalScores[index] === maxScore);

      if (winningTeams.length === 1) {
        winnerDisplay.textContent = `Team ${winningTeams[0]} Won!`;
        confetti({
          particleCount: 100,
          spread: 70,
          origin: { y: 0.6 },
        });
      } else {
        winnerDisplay.textContent = "It's a tie!";
      }

      winnerDisplay.style.display = "block";

      scoreTableBody.innerHTML = teamColors
        .slice(0, parseInt(document.getElementById('teams').value, 10))
        .map((team, index) => {
          const rounds = teamScores[index].map((score, round) => `<td>${score}</td>`).join("");
          const total = teamScores[index].reduce((a, b) => a + b, 0);
          return `
            <tr>
              <td>${team}</td>
              ${rounds}
              <td>${total}</td>
            </tr>
          `;
        })
        .join("");
    }

    document.getElementById('end-game-button').addEventListener('click', endGame);
  </script>
</body>
</html>
